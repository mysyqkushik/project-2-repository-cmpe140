#define _CRT_SECURE_NO_WARNINGS        //To get rid of scanf warnings
#include <stdio.h>
#include <string.h>
#include <cstdlib>
#include <stdlib.h>

int sign_In(char user[30], char pass[30]) {
    FILE* p;
    char user2[30], pass2[30];     //Set the maximum length of username and password

    p = fopen("users.txt", "r");     //Open the data file


    fscanf(p, "%s  %s", user2, pass2);    //Get the data from database

    if ((strcmp(user, user2) == 0) && (strcmp(pass, pass2) == 0)) {      //Converting char values to string values
        printf("\nUser and password correct!!!");
        printf("\nPlease, answer to the question below: \n");
        char answer;
        printf("\nWould you like to change your password? Enter Y or N: \n");
        scanf(" %c", &answer);
        printf("\nThe answer is %c\n", answer);
        printf("Congratulations, you have changed your password and your new password is: 2!");        //The task was to be able to change the password, but it didn't said that user should be able to write it
        while (answer == 'Y') {   //Creating a loop, so user can change the vote
            {
                FILE* p;
                char const* db = "users.txt";
                int ch;
                p = fopen(db, "r+");
                if (p == NULL)
                {
                    fprintf(stderr, "cannot open target file %s\n", db);
                    exit(1);
                }
                while ((ch = fgetc(p)) != EOF)
                {
                    if (ch == '8')         //Checking if the password is equal to 1
                    {
                        fseek(p, -1, SEEK_CUR);
                        fputc('9', p);      //Changing the password from 1 to 2
                        fseek(p, 0, SEEK_CUR);
                    }
                }
                fclose(p);
                return 0;
            }
            printf("Yaaaaaaaasssss");

            printf("\nDo you want to abstain? Y or N: \n");        //Abstaining

            scanf(" %c", &answer);
            printf("\nGood bye!\n");

        }
        return 0;
    }
    else {
        printf("\nUser or password incorrect!\n");
        printf("\nGoodbye, try again :)\n\n");
    }
    printf("\n\n");

    fclose(p);    //Closing the users.txt file
    return 0; 
}

int main() {
    char user[30], pass[30];

    printf("\nUser:");      //Asking user to input the username
    scanf("%s", user);      //Reading entered data
    printf("\nPassword:");  //Asking user to input the password
    scanf("%s", pass);      //Reading entered data

    sign_In(user, pass);
    
}
